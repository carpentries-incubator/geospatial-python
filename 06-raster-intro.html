<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to Geospatial Raster and Vector Data with Python: Read and visualize raster data</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="background-color: #001483; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #FFF7F1">
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
            Beta
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/06-raster-intro.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to Geospatial Raster and Vector Data with Python
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to Geospatial Raster and Vector Data with Python
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Geospatial Raster and Vector Data with Python
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 20%" class="percentage">
    20%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 20%" aria-valuenow="20" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/06-raster-intro.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <?xml version="1.0" encoding="UTF-8"?><div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
      <a href="index.html">Summary and Setup</a>
    </div>
    <!--/div.accordion-header-->
  </div>
  <!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro-raster-data.html">1. Introduction to Raster Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-intro-vector-data.html">2. Introduction to Vector Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-crs.html">3. Coordinate Reference Systems</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-geo-landscape.html">4. The Geospatial Landscape</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-access-data.html">5. Access satellite imagery using Python</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Read and visualize raster data
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#load-a-raster-and-view-attributes">Load a Raster and View Attributes</a></li>
<li><a href="#visualize-a-raster">Visualize a Raster</a></li>
<li><a href="#view-raster-coordinate-reference-system-crs-in-python">View Raster Coordinate Reference System (CRS) in Python</a></li>
<li><a href="#calculate-raster-statistics">Calculate Raster Statistics</a></li>
<li><a href="#dealing-with-missing-data">Dealing with Missing Data</a></li>
<li><a href="#raster-bands">Raster Bands</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-vector-data-in-python.html">7. Vector data in Python</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-crop-raster-data.html">8. Crop raster data with rioxarray and geopandas</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-raster-calculations.html">9. Raster Calculations in Python</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-zonal-statistics.html">10. Calculating Zonal Statistics on Rasters</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-parallel-raster-computations.html">11. Parallel raster computations using Dask</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-access-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-vector-data-in-python.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-access-data.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Access satellite
        </a>
        <a class="chapter-link float-end" href="07-vector-data-in-python.html" rel="next">
          Next: Vector data in... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Read and visualize raster data</h1>
        <p>Last updated on 2023-08-23 |
        
        <a href="https://github.com/carpentries-incubator/geospatial-python/edit/main/episodes/06-raster-intro.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How is a raster represented by rioxarray?</li>
<li>How do I read and plot raster data in Python?</li>
<li>How can I handle missing data?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Describe the fundamental attributes of a raster dataset.</li>
<li>Explore raster attributes and metadata using Python.</li>
<li>Read rasters into Python using the <code>rioxarray</code>
package.</li>
<li>Visualize single/multi-band raster data.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Raster datasets have been introduced in <a href="01-intro-raster-data.html">Episode 1: Introduction to Raster
Data</a>. Here, we introduce the fundamental principles, packages and
metadata/raster attributes for working with raster data in Python. We
will also explore how Python handles missing and bad data values.</p>
<p><a href="https://corteva.github.io/rioxarray/stable/" class="external-link"><code>rioxarray</code></a>
is the Python package we will use throughout this lesson to work with
raster data. It is based on the popular <a href="https://rasterio.readthedocs.io/en/latest/" class="external-link"><code>rasterio</code></a>
package for working with rasters and <a href="https://xarray.pydata.org/en/stable/" class="external-link"><code>xarray</code></a> for
working with multi-dimensional arrays. <code>rioxarray</code> extends
<code>xarray</code> by providing top-level functions (e.g. the
<code>open_rasterio</code> function to open raster datasets) and by
adding a set of methods to the main objects of the <code>xarray</code>
package (the <code>Dataset</code> and the <code>DataArray</code>). These
additional methods are made available via the <code>rio</code> accessor
and become available from <code>xarray</code> objects after importing
<code>rioxarray</code>.</p>
<p>We will also use the <a href="https://github.com/stac-utils/pystac" class="external-link"><code>pystac</code></a>
package to load rasters from the search results we created in the
previous episode.</p>
<div id="introduce-the-raster-data" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="introduce-the-raster-data" class="callout-inner">
<h3 class="callout-title">Introduce the Raster Data<a class="anchor" aria-label="anchor" href="#introduce-the-raster-data"></a>
</h3>
<div class="callout-content">
<p>We’ll continue from the results of the satellite image search that we
have carried out in an exercise from <a href="05-access-data.html">a
previous episode</a>. We will load data starting from the
<code>search.json</code> file, using one scene from the search results
as an example to demonstrate data loading and visualization.</p>
<p>If you would like to work with the data for this lesson without
downloading data on-the-fly, you can download the raster data ahead of
time using this <a href="https://figshare.com/ndownloader/files/36028100" class="external-link">link</a>. Save
the <code>geospatial-python-raster-dataset.tar.gz</code> file in your
current working directory, and extract the archive file by
double-clicking on it or by running the following command in your
terminal <code>tar -zxvf geospatial-python-raster-dataset.tar.gz</code>.
Use the file <code>geospatial-python-raster-dataset/search.json</code>
(instead of <code>search.json</code>) to get started with this
lesson.</p>
<p>This can be useful if you need to download the data ahead of time to
work through the lesson offline, or if you want to work with the data in
a different GIS.</p>
</div>
</div>
</div>
<section id="load-a-raster-and-view-attributes"><h2 class="section-heading">Load a Raster and View Attributes<a class="anchor" aria-label="anchor" href="#load-a-raster-and-view-attributes"></a>
</h2>
<hr class="half-width"><p>In the previous episode, we searched for Sentinel-2 images, and then
saved the search results to a file: <code>search.json</code>. This
contains the information on where and how to access the target images
from a remote repository. We can use the function
<code>pystac.ItemCollection.from_file()</code> to load the search
results as an <code>Item</code> list.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pystac</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> pystac.ItemCollection.from_file(<span class="st">"search.json"</span>)</span></code></pre>
</div>
<p>In the search results, we have 2 <code>Item</code> type objects,
corresponding to 4 Sentinel-2 scenes from March 26th and 28th in 2020.
We will focus on the first scene <code>S2A_31UFU_20200328_0_L2A</code>,
and load band <code>nir09</code> (central wavelength 945 nm). We can
load this band using the function
<code>rioxarray.open_rasterio()</code>, via the Hypertext Reference
<code>href</code> (commonly referred to as a URL):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>raster_ams_b9 <span class="op">=</span> rioxarray.open_rasterio(items[<span class="dv">0</span>].assets[<span class="st">"nir09"</span>].href)</span></code></pre>
</div>
<p>By calling the variable name in the jupyter notebook we can get a
quick look at the shape and attributes of the data.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;xarray.DataArray (band: 1, y: 1830, x: 1830)&gt;
[3348900 values with dtype=uint16]
Coordinates:
  * band         (band) int64 1
  * x            (x) float64 6e+05 6.001e+05 6.002e+05 ... 7.097e+05 7.098e+05
  * y            (y) float64 5.9e+06 5.9e+06 5.9e+06 ... 5.79e+06 5.79e+06
    spatial_ref  int64 0
Attributes:
    _FillValue:    0.0
    scale_factor:  1.0
    add_offset:    0.0</code></pre>
</div>
<p>The first call to <code>rioxarray.open_rasterio()</code> opens the
file from remote or local storage, and then returns a
<code>xarray.DataArray</code> object. The object is stored in a
variable, i.e. <code>raster_ams_b9</code>. Reading in the data with
<code>xarray</code> instead of <code>rioxarray</code> also returns a
<code>xarray.DataArray</code>, but the output will not contain the
geospatial metadata (such as projection information). You can use numpy
functions or built-in Python math operators on a
<code>xarray.DataArray</code> just like a numpy array. Calling the
variable name of the <code>DataArray</code> also prints out all of its
metadata information.</p>
<p>The output tells us that we are looking at an
<code>xarray.DataArray</code>, with <code>1</code> band,
<code>1830</code> rows, and <code>1830</code> columns. We can also see
the number of pixel values in the <code>DataArray</code>, and the type
of those pixel values, which is unsigned integer (or
<code>uint16</code>). The <code>DataArray</code> also stores different
values for the coordinates of the <code>DataArray</code>. When using
<code>rioxarray</code>, the term coordinates refers to spatial
coordinates like <code>x</code> and <code>y</code> but also the
<code>band</code> coordinate. Each of these sequences of values has its
own data type, like <code>float64</code> for the spatial coordinates and
<code>int64</code> for the <code>band</code> coordinate.</p>
<p>This <code>DataArray</code> object also has a couple of attributes
that are accessed like <code>.rio.crs</code>, <code>.rio.nodata</code>,
and <code>.rio.bounds()</code>, which contain the metadata for the file
we opened. Note that many of the metadata are accessed as attributes
without <code>()</code>, but <code>bounds()</code> is a method (i.e. a
function in an object) and needs parentheses.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.crs)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.nodata)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.bounds())</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.width)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.height)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>EPSG:32631
0
(600000.0, 5790240.0, 709800.0, 5900040.0)
1830
1830</code></pre>
</div>
<p>The Coordinate Reference System, or
<code>raster_ams_b9.rio.crs</code>, is reported as the string
<code>EPSG:32631</code>. The <code>nodata</code> value is encoded as 0
and the bounding box corners of our raster are represented by the output
of <code>.bounds()</code> as a <code>tuple</code> (like a list but you
can’t edit it). The height and width match what we saw when we printed
the <code>DataArray</code>, but by using <code>.rio.width</code> and
<code>.rio.height</code> we can access these values if we need them in
calculations.</p>
<p>We will be exploring this data throughout this episode. By the end of
this episode, you will be able to understand and explain the metadata
output.</p>
<div id="tip---variable-names" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip---variable-names" class="callout-inner">
<h3 class="callout-title">Tip - Variable names<a class="anchor" aria-label="anchor" href="#tip---variable-names"></a>
</h3>
<div class="callout-content">
<p>To improve code readability, file and object names should be used
that make it clear what is in the file. The data for this episode covers
Amsterdam, and is from Band 9, so we’ll use a naming convention of
<code>raster_ams_b9</code>.</p>
</div>
</div>
</div>
</section><section id="visualize-a-raster"><h2 class="section-heading">Visualize a Raster<a class="anchor" aria-label="anchor" href="#visualize-a-raster"></a>
</h2>
<hr class="half-width"><p>After viewing the attributes of our raster, we can examine the raw
values of the array with <code>.values</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.values</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>array([[[    0,     0,     0, ...,  8888,  9075,  8139],
        [    0,     0,     0, ..., 10444, 10358,  8669],
        [    0,     0,     0, ..., 10346, 10659,  9168],
        ...,
        [    0,     0,     0, ...,  4295,  4289,  4320],
        [    0,     0,     0, ...,  4291,  4269,  4179],
        [    0,     0,     0, ...,  3944,  3503,  3862]]], dtype=uint16)</code></pre>
</div>
<p>This can give us a quick view of the values of our array, but only at
the corners. Since our raster is loaded in python as a
<code>DataArray</code> type, we can plot this in one line similar to a
pandas <code>DataFrame</code> with <code>DataArray.plot()</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.plot()</span></code></pre>
</div>
<figure><img src="fig/E06/overview-plot-B09.png" alt="raster plot with defualt setting" class="figure mx-auto d-block"><figcaption>Raster plot with rioxarray</figcaption></figure><p>Nice plot! Notice that <code>rioxarray</code> helpfully allows us to
plot this raster with spatial coordinates on the x and y axis (this is
not the default in many cases with other functions or libraries).</p>
<p>This plot shows the satellite measurement of the spectral band
<code>nir09</code> for an area that covers part of the Netherlands.
According to the <a href="https://sentinels.copernicus.eu/web/sentinel/technical-guides/sentinel-2-msi/msi-instrument" class="external-link">Sentinel-2
documentaion</a>, this is a band with the central wavelength of 945nm,
which is sensitive to water vapor. It has a spatial resolution of 60m.
Note that the <code>band=1</code> in the image title refers to the
ordering of all the bands in the <code>DataArray</code>, not the
Sentinel-2 band number <code>09</code> that we saw in the pystac search
results.</p>
<p>With a quick view of the image, we notice that half of the image is
blank, no data is captured. We also see that the cloudy pixels at the
top have high reflectance values, while the contrast of everything else
is quite low. This is expected because this band is sensitive to the
water vapor. However if one would like to have a better color contrast,
one can add the option <code>robust=True</code>, which displays values
between the 2nd and 98th percentile:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.plot(robust<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<figure><img src="fig/E06/overview-plot-B09-robust.png" alt="raster plot with robust setting" class="figure mx-auto d-block"><figcaption>Raster plot using the “robust” setting</figcaption></figure><p>Now the color limit is set in a way fitting most of the values in the
image. We have a better view of the ground pixels.</p>
<div id="tool-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tool-tip" class="callout-inner">
<h3 class="callout-title">Tool Tip<a class="anchor" aria-label="anchor" href="#tool-tip"></a>
</h3>
<div class="callout-content">
<p>The option <code>robust=True</code> always forces displaying values
between the 2nd and 98th percentile. Of course, this will not work for
every case. For a customized displaying range, you can also manually
specifying the keywords <code>vmin</code> and <code>vmax</code>. For
example ploting between <code>100</code> and <code>7000</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.plot(vmin<span class="op">=</span><span class="dv">100</span>, vmax<span class="op">=</span><span class="dv">7000</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</section><section id="view-raster-coordinate-reference-system-crs-in-python"><h2 class="section-heading">View Raster Coordinate Reference System (CRS) in Python<a class="anchor" aria-label="anchor" href="#view-raster-coordinate-reference-system-crs-in-python"></a>
</h2>
<hr class="half-width"><p>Another information that we’re interested in is the CRS, and it can
be accessed with <code>.rio.crs</code>. We introduced the concept of a
CRS in <a href="03-crs.html">an earlier episode</a>. Now we will see how
features of the CRS appear in our data file and what meanings they have.
We can view the CRS string associated with our DataArray’s
<code>rio</code> object using the <code>crs</code> attribute.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.rio.crs)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">EPSG</span><span class="op">:</span><span class="fl">32631</span></span></code></pre>
</div>
<p>To print the EPSG code number as an <code>int</code>, we use the
<code>.to_epsg()</code> method:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.rio.crs.to_epsg()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">32631</span></span></code></pre>
</div>
<p>EPSG codes are great for succinctly representing a particular
coordinate reference system. But what if we want to see more details
about the CRS, like the units? For that, we can use <code>pyproj</code>,
a library for representing and working with coordinate reference
systems.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> CRS</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>epsg <span class="op">=</span> raster_ams_b9.rio.crs.to_epsg()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>crs <span class="op">=</span> CRS(epsg)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>crs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Derived Projected CRS: EPSG:32631&gt;
Name: WGS 84 / UTM zone 31N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Between 0°E and 6°E, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Andorra. Belgium. Benin. Burkina Faso. Denmark - North Sea. France. Germany - North Sea. Ghana. Luxembourg. Mali. Netherlands. Niger. Nigeria. Norway. Spain. Togo. United Kingdom (UK) - North Sea.
- bounds: (0.0, 0.0, 6.0, 84.0)
Coordinate Operation:
- name: UTM zone 31N
- method: Transverse Mercator
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
<p>The <code>CRS</code> class from the <code>pyproj</code> library
allows us to create a <code>CRS</code> object with methods and
attributes for accessing specific information about a CRS, or the
detailed summary shown above.</p>
<p>A particularly useful attribute is <code>area_of_use</code>, which
shows the geographic bounds that the CRS is intended to be used.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>crs.area_of_use</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">AreaOfUse</span><span class="op">(</span>west<span class="op">=</span><span class="fl">0.0</span>, south<span class="op">=</span><span class="fl">0.0</span>, east<span class="op">=</span><span class="fl">6.0</span>, north<span class="op">=</span><span class="fl">84.0</span>, name<span class="op">=</span><span class="st">'Between 0°E and 6°E, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Andorra. Belgium. Benin. Burkina Faso. Denmark - North Sea. France. Germany - North Sea. Ghana. Luxembourg. Mali. Netherlands. Niger. Nigeria. Norway. Spain. Togo. United Kingdom (UK) - North Sea.'</span><span class="op">)</span></span></code></pre>
</div>
<div id="exercise-find-the-axes-units-of-the-crs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-find-the-axes-units-of-the-crs" class="callout-inner">
<h3 class="callout-title">Exercise: find the axes units of the CRS<a class="anchor" aria-label="anchor" href="#exercise-find-the-axes-units-of-the-crs"></a>
</h3>
<div class="callout-content">
<p>What units are our data in? See if you can find a method to examine
this information using <code>help(crs)</code> or
<code>dir(crs)</code></p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>crs.axis_info</code> tells us that the CRS for our raster has
two axis and both are in meters. We could also get this information from
the attribute <code>raster_ams_b9.rio.crs.linear_units</code>.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="understanding-pyproj-crs-summary">Understanding pyproj CRS Summary<a class="anchor" aria-label="anchor" href="#understanding-pyproj-crs-summary"></a></h3>
<p>Let’s break down the pieces of the <code>pyproj</code> CRS summary.
The string contains all of the individual CRS elements that Python or
another GIS might need, separated into distinct sections, and datum.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;Derived Projected CRS: EPSG:32631&gt;
Name: WGS 84 / UTM zone 31N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Between 0°E and 6°E, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Andorra. Belgium. Benin. Burkina Faso. Denmark - North Sea. France. Germany - North Sea. Ghana. Luxembourg. Mali. Netherlands. Niger. Nigeria. Norway. Spain. Togo. United Kingdom (UK) - North Sea.
- bounds: (0.0, 0.0, 6.0, 84.0)
Coordinate Operation:
- name: UTM zone 31N
- method: Transverse Mercator
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
<ul><li>
<strong>Name</strong> of the projection is UTM zone 31N (UTM has 60
zones, each 6-degrees of longitude in width). The underlying datum is
WGS84.</li>
<li>
<strong>Axis Info</strong>: the CRS shows a Cartesian system with
two axes, easting and northing, in meter units.</li>
<li>
<strong>Area of Use</strong>: the projection is used for a
particular range of longitudes <code>0°E to 6°E</code> in the northern
hemisphere (<code>0.0°N to 84.0°N</code>)</li>
<li>
<strong>Coordinate Operation</strong>: the operation to project the
coordinates (if it is projected) onto a cartesian (x, y) plane.
Transverse Mercator is accurate for areas with longitudinal widths of a
few degrees, hence the distinct UTM zones.</li>
<li>
<strong>Datum</strong>: Details about the datum, or the reference
point for coordinates. <code>WGS 84</code> and <code>NAD 1983</code> are
common datums. <code>NAD 1983</code> is <a href="https://en.wikipedia.org/wiki/Datum_of_2022" class="external-link">set to be replaced in
2022</a>.</li>
</ul><p>Note that the zone is unique to the UTM projection. Not all CRSs will
have a zone. Below is a simplified view of US UTM zones.</p>
<figure><img src="fig/E03/Utm-zones-USA.svg" alt="UTM zones across the CONUS" class="figure mx-auto d-block"><figcaption>The UTM zones across the continental United States
(Chrismurf at English Wikipedia, via <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#/media/File:Utm-zones-USA.svg" class="external-link">Wikimedia
Commons</a> (CC-BY))</figcaption></figure></div>
</section><section id="calculate-raster-statistics"><h2 class="section-heading">Calculate Raster Statistics<a class="anchor" aria-label="anchor" href="#calculate-raster-statistics"></a>
</h2>
<hr class="half-width"><p>It is useful to know the minimum or maximum values of a raster
dataset. We can compute these and other descriptive statistics with
<code>min</code>, <code>max</code>, <code>mean</code>, and
<code>std</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.<span class="bu">min</span>())</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.<span class="bu">max</span>())</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.mean())</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.std())</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;xarray.DataArray ()&gt;
array(0, dtype=uint16)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(15497, dtype=uint16)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(1652.44009944)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(2049.16447495)
Coordinates:
    spatial_ref  int64 0</code></pre>
</div>
<p>The information above includes a report of the min, max, mean, and
standard deviation values, along with the data type. If we want to see
specific quantiles, we can use xarray’s <code>.quantile()</code> method.
For example for the 25% and 75% quantiles:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raster_ams_b9.quantile([<span class="fl">0.25</span>, <span class="fl">0.75</span>]))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;xarray.DataArray (quantile: 2)&gt;
array([   0., 2911.])
Coordinates:
  * quantile  (quantile) float64 0.25 0.75</code></pre>
</div>
<div id="data-tip---numpy-methods" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---numpy-methods" class="callout-inner">
<h3 class="callout-title">Data Tip - NumPy methods<a class="anchor" aria-label="anchor" href="#data-tip---numpy-methods"></a>
</h3>
<div class="callout-content">
<p>You could also get each of these values one by one using
<code>numpy</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(numpy.percentile(raster_ams_b9, <span class="dv">25</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(numpy.percentile(raster_ams_b9, <span class="dv">75</span>))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">0.0</span></span>
<span><span class="fl">2911.0</span></span></code></pre>
</div>
<p>You may notice that <code>raster_ams_b9.quantile</code> and
<code>numpy.percentile</code> didn’t require an argument specifying the
axis or dimension along which to compute the quantile. This is because
<code>axis=None</code> is the default for most numpy functions, and
therefore <code>dim=None</code> is the default for most xarray methods.
It’s always good to check out the docs on a function to see what the
default arguments are, particularly when working with multi-dimensional
image data. To do so, we can
use<code>help(raster_ams_b9.quantile)</code> or
<code>?raster_ams_b9.percentile</code> if you are using jupyter notebook
or jupyter lab.</p>
</div>
</div>
</div>
</section><section id="dealing-with-missing-data"><h2 class="section-heading">Dealing with Missing Data<a class="anchor" aria-label="anchor" href="#dealing-with-missing-data"></a>
</h2>
<hr class="half-width"><p>So far, we have visualized a band of a Sentinel-2 scene and
calculated its statistics. However, we need to take missing data into
account. Raster data often has a “no data value” associated with it and
for raster datasets read in by <code>rioxarray</code>. This value is
referred to as <code>nodata</code>. This is a value assigned to pixels
where data is missing or no data were collected. There can be different
cases that cause missing data, and it’s common for other values in a
raster to represent different cases. The most common example is missing
data at the edges of rasters.</p>
<p>By default the shape of a raster is always rectangular. So if we have
a dataset that has a shape that isn’t rectangular, some pixels at the
edge of the raster will have no data values. This often happens when the
data were collected by a sensor which only flew over some part of a
defined region.</p>
<p>As we have seen above, the <code>nodata</code> value of this dataset
(<code>raster_ams_b9.rio.nodata</code>) is 0. When we have plotted the
band data, or calculated statistics, the missing value was not
distinguished from other values. Missing data may cause some unexpected
results. For example, the 25th percentile we just calculated was 0,
probably reflecting the presence of a lot of missing data in the
raster.</p>
<p>To distinguish missing data from real data, one possible way is to
use <code>nan</code> to represent them. This can be done by specifying
<code>masked=True</code> when loading the raster:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9 <span class="op">=</span> rioxarray.open_rasterio(items[<span class="dv">0</span>].assets[<span class="st">"nir09"</span>].href, masked<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>One can also use the <code>where</code> function to select all the
pixels which are different from the <code>nodata</code> value of the
raster:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>raster_ams_b9.where(raster_ams_b9<span class="op">!=</span>raster_ams_b9.rio.nodata)</span></code></pre>
</div>
<p>Either way will change the <code>nodata</code> value from 0 to
<code>nan</code>. Now if we compute the statistics again, the missing
data will not be considered:</p>
<pre><code>print(raster_ams_b9.min())
print(raster_ams_b9.max())
print(raster_ams_b9.mean())
print(raster_ams_b9.std())
```python

```output
&lt;xarray.DataArray ()&gt;
array(8., dtype=float32)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(15497., dtype=float32)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(2477.405, dtype=float32)
Coordinates:
    spatial_ref  int64 0
&lt;xarray.DataArray ()&gt;
array(2061.9539, dtype=float32)
Coordinates:
    spatial_ref  int64 0</code></pre>
<p>And if we plot the image, the <code>nodata</code> pixels are not
shown because they are not 0 anymore:</p>
<figure><img src="fig/E06/overview-plot-B09-robust-with-nan.png" alt="raster plot masking missing values" class="figure mx-auto d-block"><figcaption>Raster plot after masking out missing values</figcaption></figure><p>One should notice that there is a side effect of using
<code>nan</code> instead of <code>0</code> to represent the missing
data: the data type of the <code>DataArray</code> was changed from
integers to float. This need to be taken into consideration when the
data type matters in your application.</p>
</section><section id="raster-bands"><h2 class="section-heading">Raster Bands<a class="anchor" aria-label="anchor" href="#raster-bands"></a>
</h2>
<hr class="half-width"><p>So far we looked into a single band raster, i.e. the
<code>nir09</code> band of a Sentinel-2 scene. However, to get a
smaller, non georeferenced version of the scene, one may also want to
visualize the true-color overview of the region. This is provided as a
multi-band raster – a raster dataset that contains more than one
band.</p>
<figure><img src="fig/E06/single_multi_raster.png" alt="multi-band raster" class="figure mx-auto d-block"><figcaption>Sketch of a multi-band raster image</figcaption></figure><p>The <code>overview</code> asset in the Sentinel-2 scene is a
multiband asset. Similar to <code>nir09</code>, we can load it by:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>raster_ams_overview <span class="op">=</span> rioxarray.open_rasterio(items[<span class="dv">0</span>].assets[<span class="st">'visual'</span>].href, overview_level<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>raster_ams_overview</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;xarray.DataArray (band: 3, y: 687, x: 687)&gt;
[1415907 values with dtype=uint8]
Coordinates:
  * band         (band) int64 1 2 3
  * x            (x) float64 6.001e+05 6.002e+05 ... 7.096e+05 7.097e+05
  * y            (y) float64 5.9e+06 5.9e+06 5.9e+06 ... 5.79e+06 5.79e+06
    spatial_ref  int64 0
Attributes:
    AREA_OR_POINT:       Area
    OVR_RESAMPLING_ALG:  AVERAGE
    _FillValue:          0
    scale_factor:        1.0
    add_offset:          0.0</code></pre>
</div>
<p>The band number comes first when GeoTiffs are read with the
<code>.open_rasterio()</code> function. As we can see in the
<code>xarray.DataArray</code> object, the shape is now
<code>(band: 3, y: 687, x: 687)</code>, with three bands in the
<code>band</code> dimension. It’s always a good idea to examine the
shape of the raster array you are working with and make sure it’s what
you expect. Many functions, especially the ones that plot images, expect
a raster array to have a particular shape. One can also check the shape
using the <code>.shape</code> attribute:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>raster_ams_overview.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(3, 687, 687)</code></pre>
</div>
<p>One can visualize the multi-band data with the
<code>DataArray.plot.imshow()</code> function:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>raster_ams_overview.plot.imshow()</span></code></pre>
</div>
<figure><img src="fig/E06/overview-plot-true-color.png" alt="true-color image overview" class="figure mx-auto d-block"><figcaption>Overview of the true-color image (multi-band
raster)</figcaption></figure><p>Note that the <code>DataArray.plot.imshow()</code> function makes
assumptions about the shape of the input DataArray, that since it has
three channels, the correct colormap for these channels is RGB. It does
not work directly on image arrays with more than 3 channels. One can
replace one of the RGB channels with another band, to make a false-color
image.</p>
<div id="exercise-set-the-plotting-aspect-ratio" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-set-the-plotting-aspect-ratio" class="callout-inner">
<h3 class="callout-title">Exercise: set the plotting aspect ratio<a class="anchor" aria-label="anchor" href="#exercise-set-the-plotting-aspect-ratio"></a>
</h3>
<div class="callout-content">
<p>As seen in the figure above, the true-color image is stretched. Let’s
visualize it with the right aspect ratio. You can use the <a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.plot.imshow.html" class="external-link">documentation</a>
of <code>DataArray.plot.imshow()</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Since we know the height/width ratio is 1:1 (check the
<code>rio.height</code> and <code>rio.width</code> attributes), we can
set the aspect ratio to be 1. For example, we can choose the size to be
5 inches, and set <code>aspect=1</code>. Note that according to the <a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.plot.imshow.html" class="external-link">documentation</a>
of <code>DataArray.plot.imshow()</code>, when specifying the
<code>aspect</code> argument, <code>size</code> also needs to be
provided.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>raster_ams_overview.plot.imshow(size<span class="op">=</span><span class="dv">5</span>, aspect<span class="op">=</span><span class="dv">1</span>)</span></code></pre>
</div>
<figure><img src="fig/E06/overview-plot-true-color-aspect-equal.png" alt="raster plot with correct aspect ratio" class="figure mx-auto d-block"><figcaption>Overview of the true-color image with the correct
aspect ratio</figcaption></figure></div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>
<code>rioxarray</code> and <code>xarray</code> are for working with
multidimensional arrays like pandas is for working with tabular
data.</li>
<li>
<code>rioxarray</code> stores CRS information as a CRS object that
can be converted to an EPSG code or PROJ4 string.</li>
<li>Missing raster data are filled with nodata values, which should be
handled with care for statistics and visualization.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-access-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-vector-data-in-python.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-access-data.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Access satellite
        </a>
        <a class="chapter-link float-end" href="07-vector-data-in-python.html" rel="next">
          Next: Vector data in... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/geospatial-python/edit/main/episodes/06-raster-intro.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/geospatial-python/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/geospatial-python/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/geospatial-python/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.1" class="external-link">sandpaper (0.16.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/geospatial-python/06-raster-intro.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Read and visualize raster data",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/geospatial-python/06-raster-intro.html",
  "identifier": "https://carpentries-incubator.github.io/geospatial-python/06-raster-intro.html",
  "dateCreated": "2023-11-09",
  "dateModified": "2023-08-23",
  "datePublished": "2023-12-19"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

